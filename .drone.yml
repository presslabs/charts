---
kind: pipeline
name: default

steps:
- name: git
  pull: default
  image: plugins/git
  settings:
    depth: 0
  tags: true

- name: update-chart-index
  image: presslabs/build:stable
  pull: always
  # secrets:
  #   - SSH_KEY
  environment:
    DOCKER_HOST: unix:///workspace/docker.sock
    GOOGLE_CREDENTIALS:
      from_secret: PL_INFRA_GCR_IO_PUSH
    GIT_USER: presslabs-bot
    GIT_PASSWORD:
      from_secret: GH_PASSWORD
  commands:
    - /usr/local/bin/setup-credentials-helper.sh
    # - git config --global user.email "bot@presslabs.com"
    # - git config --global user.name "Igor Debot"
    # - git config --global push.default current
    - git remote set-url origin git@github.com:presslabs/charts.git
    - ssh-keyscan -H github.com > /etc/ssh/ssh_known_hosts
    - make index
    - make publish
  when:
    branch: master
---
kind: signature
hmac: 7eaacae4ad7ac9ca07ff4b21336bf6209f53e2f804e9d06e4bc3c5bd40af045a

...
